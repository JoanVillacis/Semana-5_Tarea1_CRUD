namespace _02_CRUD.Controladores
{
    using _02_CRUD.Config;
    using _02_CRUD.Modelos;
    using System;
    using Microsoft.EntityFrameworkCore;

    public class Usuarios_Controller
    {
        public readonly sqlServer_dbcontext _Usuario_Dbcontext = new sqlServer_dbcontext();

        public List<Usuario_Model> todos()
        {
            var list = new List<Usuario_Model>();
            list = _Usuario_Dbcontext.Usuarios.Include(u => u.Rol).ToList();
            foreach (var usuario in list)
            {
                usuario.nombre_completo_Usuario = usuario.Nombres_Usuario + " " + usuario.Apellidos_Usuario;
                usuario.Rol_Nombre = usuario.Rol != null ? usuario.Rol.Nombre_Rol : string.Empty;
            }
            return list;
        }

        public Usuario_Model uno(int id)
        {
            return _Usuario_Dbcontext.Usuarios.Include(u => u.Rol).FirstOrDefault(u => u.Id_Usuario == id);
        }
        public string insetar(Usuario_Model Usuario_Model)
        {
            if (Usuario_Model == null)
            {
                return "Debe completar las cajas de texto para guardar al Usuario";
            }
            else
            {
                try
                {
                    _Usuario_Dbcontext.Add(Usuario_Model);
                    _Usuario_Dbcontext.SaveChanges();
                    return "ok";
                }
                catch (Exception ex)
                {
                    return "Ocurrio un error al insertar el usuario: " + ex.Message;
                }
            }
        }

        public string editar(Usuario_Model Usuario_Model)
        {
            if (Usuario_Model == null)
            {
                return "Debe completar las cajas de texto para guardar al Usuario";
            }
            else
            {
                var usuario_existente = _Usuario_Dbcontext.Usuarios.FirstOrDefault(u => u.Id_Usuario == Usuario_Model.Id_Usuario);
                if (usuario_existente == null)
                {
                    return "Usuario no encontrado";
                }

                try
                {
                    usuario_existente.Nombres_Usuario = Usuario_Model.Nombres_Usuario;
                    usuario_existente.Apellidos_Usuario = Usuario_Model.Apellidos_Usuario;
                    usuario_existente.Cedula_Usuario = Usuario_Model.Cedula_Usuario;
                    usuario_existente.Correo_Usuario = Usuario_Model.Correo_Usuario;
                    usuario_existente.Contrasenia = Usuario_Model.Contrasenia;
                    usuario_existente.Estado_Usuario = Usuario_Model.Estado_Usuario;
                    usuario_existente.Rol_Id = Usuario_Model.Rol_Id;


                    _Usuario_Dbcontext.SaveChanges();
                    return "ok";
                }
                catch (Exception ex)
                {
                    return "Ocurrio un error al actualizar el usuario: " + ex.Message;
                }
            }
        }

        public string eliminar(int id)
        {
            var usuario = _Usuario_Dbcontext.Usuarios.Find(id);
            if (usuario == null)
            {
                return "No se encontró el usuario a eliminar";
            }
            try
            {
                _Usuario_Dbcontext.Usuarios.Remove(usuario);
                _Usuario_Dbcontext.SaveChanges();
                return "ok";
            }
            catch (Exception ex)
            {
                return "Ocurrio un error al eliminar el usuario: " + ex.Message;
            }
        }

        public string eliminacion_suave(int id)
        {
            if (id <= 0) return "Error al eliminar, el usuario no existe";
            var usuario = _Usuario_Dbcontext.Usuarios.FirstOrDefault(u => u.Id_Usuario == id);
            if (usuario != null)
            {
                try
                {
                    usuario.Estado_Usuario = false;
                    _Usuario_Dbcontext.SaveChanges();
                    return "ok";
                }
                catch (Exception ex)
                {
                    return "Ocurrio un error al realizar eliminacion suave: " + ex.Message;
                }
            }
            else
            {
                return "Ocurrio un error al guardar";
            }
        }
    }
}
